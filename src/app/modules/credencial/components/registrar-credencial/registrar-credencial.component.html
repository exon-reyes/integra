@if (obteniendoDatos) {
  <app-spinner/>
} @else {
  @defer (when errorService.error(); prefetch when errorService.error()) {
    @if (errorService.error()) {
      <app-error [errorService]="errorService"></app-error>
    }
  }
  <form (ngSubmit)="guardar()" [formGroup]="myForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="col-span-2">
      <label class="required">Unidad de negocio</label>
      <p-select
        formControlName="unidad"
        scrollHeight="140px"
        styleClass="w-full mt-1"
        [options]="unidades"
        optionLabel="nombre"
        filterBy="clave,nombre"
        placeholder="Seleccionar unidad"
        filter="true">
        <ng-template let-unidad #item>
          <div class="w-full">
            <div>{{ unidad.clave }} {{ unidad.nombre }}</div>
          </div>
        </ng-template>
        <ng-template let-u #selectedItem>
          <div class="flex items-center gap-2">
            {{ u.clave }} {{ u.nombre }}
          </div>
        </ng-template>
      </p-select>
      @if (isValidField('unidad')) {
        <span class="text-sm text-red-400">Selecciona una unidad</span>
      }
    </div>

    <div class="col-span-2">
      <label class="required">Departamento</label>
      <p-select

        styleClass="w-full mt-1"
        placeholder="Seleccionar departamento"
        [options]="departamentos"
        optionLabel="nombre"
        formControlName="departamento"/>
      @if (isValidField('departamento')) {
        <span class="text-sm text-red-400">Selecciona un departamento</span>
      }
    </div>

    <div class="col-span-2">
      <label class="required">Usuario</label>
      <input
        pInputText
        formControlName="usuario"
        class="w-full mt-1"
        placeholder="Ingrese usuario"/>
      @if (isValidField('usuario')) {
        <span class="text-sm text-red-400">Ingrese usuario</span>
      }
    </div>

    <div class="col-span-2">
      <label class="required">Clave</label>
      <input
        pInputText
        formControlName="clave"
        class="w-full mt-1"
        placeholder="Ingrese la clave"/>
      @if (isValidField('clave')) {
        <span class="text-sm text-red-400">Ingrese clave</span>
      }
    </div>

    <div class="col-span-2">
      <label>Nota</label>
      <textarea
        rows="2"
        style="resize: none"
        formControlName="descripcion"
        class="w-full mt-1"
        pTextarea
        placeholder="InformaciÃ³n adicional"></textarea>
    </div>

    <div class="col-span-2 flex justify-center gap-2">
      <p-button label="Guardar" type="submit"/>
    </div>
  </form>
}
