<p-table
    [pt]="{ header: '!px-0 !pt-1' }"
    [scrollable]="true"
    [tableStyle]="{ 'min-width': '20rem' }"
    [value]="zonas()"
    scrollHeight="flex">

    <!-- Encabezado descriptivo -->
    <ng-template #caption>
        <div class="mb-4">
            <div class="p-3 bg-amber-100 rounded-lg flex items-start gap-3">
                <i class="pi pi-info-circle text-lg text-gray-500 flex-shrink-0 mt-0.5" style="font-size: 1.5rem"></i>
                <div>
                    <div class="font-semibold text-gray-800 leading-snug">Administración de Zonas</div>
                    <p class="text-sm text-gray-600 mt-1">
                        Utiliza este panel para crear y gestionar las regiones operativas.
                        <strong>Las zonas desactivadas no aparecerán</strong> en los formularios de asignación de unidades.
                    </p>
                </div>
            </div>
        </div>

        <!-- Estadísticas -->
        <div class="grid grid-cols-3 gap-4 mb-3">
            <div class="shadow border border-gray-100 rounded-lg p-3 flex items-center gap-3">
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="pi pi-arrow-up-right text-green-600"></i>
                </div>
                <div>
                    <div class="text-xl font-bold text-green-800">{{ zonasActivas }}</div>
                    <div class="text-sm text-green-600">Activas</div>
                </div>
            </div>

            <div class="shadow border border-gray-100 rounded-lg p-3 flex items-center gap-3">
                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                    <i class="pi pi-arrow-circle-down text-red-600"></i>
                </div>
                <div>
                    <div class="text-xl font-bold text-red-800">{{ zonasInactivas }}</div>
                    <div class="text-sm text-red-600">Inactivas</div>
                </div>
            </div>

            <div class="shadow border border-gray-100 rounded-lg p-3 flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="pi pi-map text-blue-600"></i>
                </div>
                <div>
                    <div class="text-xl font-bold text-blue-800">{{ totalZonas }}</div>
                    <div class="text-sm text-blue-600">Total</div>
                </div>
            </div>
        </div>

        <!-- Formulario superior -->
        <div class="flex flex-row gap-3 items-center">
            @if (zonaEditando) {
                <label class="font-medium text-gray-800">Nuevo nombre</label>
            }
            <input
                [(ngModel)]="nombreZona"
                [disabled]="loading"
                [placeholder]="zonaEditando ? 'Editando zona' : 'Nueva zona'"
                class="flex-1 border-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                pInputText
            >

            @if (zonaEditando) {
                <p-button
                    (onClick)="guardarZona()"
                    *hasPermission="Autoridades.EDITAR_ZONA"
                    label="Actualizar"
                    [loading]="loading"
                    styleClass="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors duration-200"
                ></p-button>
                <p-button
                    label="Cancelar"
                    severity="secondary"
                    (onClick)="cancelarEdicion()"
                    [disabled]="loading"
                    styleClass="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition-colors duration-200"
                ></p-button>
            }

            @if (!zonaEditando) {
                <p-button
                    (onClick)="guardarZona()"
                    *hasPermission="Autoridades.CREAR_ZONA"
                    label="Guardar"
                    [loading]="loading"
                    styleClass="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors duration-200"
                ></p-button>
            }
        </div>
    </ng-template>

    <!-- Encabezado de columnas -->
    <ng-template #header>
        <tr>
            <th>Zona</th>
            <th class="w-32 text-center">Estatus</th>
            <th class="w-32 text-center">Acciones</th>
        </tr>
    </ng-template>

    <!-- Cuerpo de la tabla -->
    <ng-template #body let-zona>
        <tr>
            <!-- Nombre -->
            <td>
                <div class="flex items-center gap-3">
                    <div class="w-3 h-3 rounded-full {{ zona.activo ? 'bg-green-400' : 'bg-gray-400' }}"></div>
                    <span class="font-medium text-gray-800">{{ zona.nombre }}</span>
                </div>
            </td>

            <!-- Toggle -->
            <td class="text-center">
                <label
                    pTooltip="{{ zona.activo ? 'Zona activa' : 'Zona inactiva' }}"
                    tooltipPosition="top"
                    class="relative inline-flex items-center cursor-pointer select-none">
                    <input
                        type="checkbox"
                        class="sr-only peer"
                        [checked]="zona.activo"
                        (change)="toggleZonaActivo(zona)"
                        *hasPermission="Autoridades.EDITAR_ZONA"
                    >
                    <div
                        class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-green-500
                               after:content-[''] after:absolute after:top-0.5 after:left-[2px]
                               after:bg-white after:border-gray-300 after:border after:rounded-full
                               after:h-5 after:w-5 after:transition-all
                               peer-checked:after:translate-x-full peer-checked:after:border-white
                               transition-colors duration-200">
                    </div>
                </label>
            </td>

            <!-- Acciones -->
            <td class="text-center">
                <div class="flex justify-center gap-1">
                    <p-button
                        (onClick)="editarZona(zona)"
                        *hasPermission="Autoridades.EDITAR_ZONA"
                        [outlined]="true"
                        icon="pi pi-pencil"
                        rounded
                        severity="info"
                        size="small"
                    ></p-button>
                    <p-button
                        (onClick)="eliminarZona(zona)"
                        *hasPermission="Autoridades.ELIMINAR_ZONA"
                        [outlined]="true"
                        icon="pi pi-trash"
                        rounded
                        severity="danger"
                        size="small"
                    ></p-button>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>
