@if (observacionId) {
} @else {

}
<div class="w-full min-h-screen ">

    <nav class="text-xs text-slate-500 mb-6" aria-label="miga de pan">
        <a href="#" class="hover:text-slate-700 transition-colors">Inicio</a>
        <span class="mx-2">/</span>
        <a href="#" class="hover:text-slate-700 transition-colors">Observaciones</a>
        <span class="mx-2">/</span>
        <span class="text-slate-600">Detalle</span>
    </nav>
    @if (observacion) {
        <div class="flex gap-2 mb-3">
         <span
             class="border border-slate-300 px-3 py-1.5 rounded-full text-xs font-mono text-red-500 font-bold bg-white shadow-sm mr-auto"
             title="Folio de la observación">
                {{observacion.folio.folio}}
            </span>

            <p-button label="Ver folio" size="small" icon="pi pi-eye"></p-button>
            <span
                class="inline-flex items-center gap-2 border border-slate-300 px-3 py-1.5 rounded-xl text-xs bg-white shadow-sm"
                title="Prioridad">
                <span class="w-2.5 h-2.5 rounded-sm bg-red-500" aria-hidden="true"></span>
                Prioridad {{observacion?.prioridad}}
            </span>
        </div>
        <header class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 mb-2">
            <div class="flex items-center gap-3">

                <h4 class="text-2xl lg:text-3xl font-bold">{{ observacion?.titulo }}</h4>
            </div>

            <div class="flex flex-wrap gap-3" aria-label="acciones rápidas">


            </div>
        </header>
    }
    <div class="space-y-6">
        @if (observacion) {
            <p-toolbar class="bg-white border-slate-300 rounded-xl p-4 shadow-md">
                <div class="flex flex-wrap gap-3">
                    <p-button label="Colaborador" severity="info" size="small" icon="pi pi-user-plus"></p-button>
                    <p-button label="Generar PDF" size="small" icon="pi pi-file-pdf"></p-button>
                    <p-button label="Ver Historial" size="small" icon="pi pi-history"
                              (onClick)="mostrarHistorial = true"></p-button>
                </div>
                <ng-template #end>
                    <p-splitbutton
                        [label]="observacion?.estatus.nombre"
                        class="z-50 "
                        size="small"
                        [model]="statusMenuItems"
                        [dropdownIcon]="'pi pi-angle-down'"
                        title="Cambiar estatus">
                    </p-splitbutton>
                    <p-button icon="pi pi-share-alt" size="small" class="ml-1"></p-button>
                </ng-template>
            </p-toolbar>
        }

        <div class="flex flex-col lg:flex-row gap-6 mb-6">
                <app-origen class="w-full lg:w-1/2" [observacionId]="observacionId"></app-origen>
                <app-responsabilidad class="w-full lg:w-1/2" [observacionId]="observacionId"></app-responsabilidad>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-3 space-y-6">
                <p-panel [toggleable]="true" header="INFORMACIÓN GENERAL"
                         class="bg-white border-slate-300 rounded-xl shadow-md">
                    <div class="space-y-4 text-slate-700">
                        <div class="grid grid-cols-1 sm:grid-cols-[180px_1fr] gap-3">
                            <div class="text-xs font-bold text-slate-500 uppercase">Observación</div>
                            <div class="text-sm">{{observacion?.tipoObservacion.nombre}} - {{observacion?.titulo}}</div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-[180px_1fr] gap-3">
                            <div class="text-xs font-bold text-slate-500 uppercase">Descripción</div>
                            <div class="text-sm leading-relaxed text-slate-600">
                                {{ observacion?.descripcion }}
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-[180px_1fr] gap-3">
                            <div class="text-xs font-bold text-slate-500 uppercase">Folio Padre</div>
                            <div class="text-sm">
                                <a class="text-red-500 hover:underline">{{ observacion?.folio.folio }}</a>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-[180px_1fr] gap-3">
                            <div class="text-xs font-bold text-slate-500 uppercase">Última actualización</div>
                            <div class="text-sm">12-12-2025 10:24</div>
                        </div>
                    </div>
                </p-panel>

                <p-panel header="COLABORACIÓN" class="bg-white border-slate-300 rounded-xl shadow-md">
                    <div class="space-y-6">
                        <div>
                            <div class="text-xs font-bold text-slate-500 uppercase mb-1 pb-4">
                                Comentarios
                            </div>
                            <div class="space-y-4 max-h-80 overflow-y-auto pr-2">
                                <div class="flex items-start gap-3 group">
                                    <div
                                        class="flex-shrink-0 w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-sm">
                                        ML
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="relative bg-slate-200 rounded-xl rounded-tl-none p-3 shadow-sm">
                                            <div class="flex items-center gap-2 text-xs text-slate-600 mb-1">
                                                <span class="font-semibold text-orange-600">María López</span>
                                                <span class="text-slate-400">•</span>
                                                <time class="font-mono text-slate-500">2025-09-02 09:10</time>
                                                <span
                                                    class="ml-auto bg-emerald-500 text-white px-2 py-0.5 rounded-full text-[10px] font-medium">En Proceso</span>
                                            </div>
                                            <div class="text-sm text-slate-800">Se agenda visita remota para revisión de
                                                logs. Solicito evidencia fotográfica del equipo y cableado.
                                            </div>
                                            <div
                                                class="absolute -left-1 top-0 w-3 h-3 bg-slate-200 transform rotate-45 rounded-sm"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3 group">
                                    <div
                                        class="flex-shrink-0 w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-sm">
                                        JP
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="relative bg-slate-200 rounded-xl rounded-tl-none p-3 shadow-sm">
                                            <div class="flex items-center gap-2 text-xs text-slate-600 mb-1">
                                                <span class="font-semibold text-blue-600">Juan Pérez</span>
                                                <span class="text-slate-400">•</span>
                                                <time class="font-mono text-slate-500">2025-09-02 11:35</time>
                                            </div>
                                            <div class="text-sm text-slate-800">Adjunto fotos de rack y detalle de patch
                                                panel. Se observan puertos con daño físico.
                                            </div>
                                            <div
                                                class="absolute -left-1 top-0 w-3 h-3 bg-slate-200 transform rotate-45 rounded-sm"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-slate-200">
                                <div class="flex items-start gap-3">
                                    <div
                                        class="flex-shrink-0 w-8 h-8 bg-slate-500 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-sm">
                                        Tú
                                    </div>
                                    <div class="flex-1">
                                        <textarea
                                            class="w-full min-h-[80px] p-3 text-sm text-slate-800 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Escribe tu comentario..."></textarea>
                                        <div class="flex justify-end mt-2">
                                            <p-button label="Enviar comentario" size="small" severity="info"
                                                      icon="pi pi-send"></p-button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="text-xs font-bold text-slate-500 uppercase mb-3">Archivos Adjuntos</div>
                            <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200">
                                <ul class="divide-y divide-slate-200 text-sm">
                                    <li class="p-3 hover:bg-slate-100 transition-colors cursor-pointer">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center gap-2">
                                                <i class="pi pi-file text-blue-500"></i>
                                                <div>
                                                    <div class="font-semibold text-slate-700">rack_frente.jpg</div>
                                                    <div class="text-xs text-slate-500">Por Juan Pérez</div>
                                                </div>
                                            </div>
                                            <span class="text-xs text-slate-500">2025-09-02</span>
                                        </div>
                                    </li>
                                    <li class="p-3 hover:bg-slate-100 transition-colors cursor-pointer">
                                        <div class="flex justify-between items-center">
                                            <div class="flex items-center gap-2">
                                                <i class="pi pi-file text-blue-500"></i>
                                                <div>
                                                    <div class="font-semibold text-slate-700">diagnostico_inicial.pdf
                                                    </div>
                                                    <div class="text-xs text-slate-500">Por María López</div>
                                                </div>
                                            </div>
                                            <span class="text-xs text-slate-500">2025-09-02</span>
                                        </div>
                                    </li>
                                </ul>
                                <p-fileupload name="demo[]" url="https://www.primefaces.org/cdn/api/upload.php"
                                              [multiple]="true" accept="image/*" maxFileSize="1000000" mode="advanced">
                                    <ng-template #empty>
                                        <div>Selecciona los archivos a subir</div>
                                    </ng-template>
                                </p-fileupload>
                            </div>
                        </div>

                        <div>
                            <div class="text-xs font-bold text-slate-500 uppercase mb-3">Subtareas</div>
                            <div class="space-y-3">
                                <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-200">
                                    <div class="flex justify-between items-center text-xs text-gray-500 mb-1">
                                        <span class="font-bold text-gray-700">2 tareas en total</span>
                                        <span class="text-gray-500">1 completada · 1 pendiente</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                        <div class="bg-sky-500 h-2 rounded-full w-1/2 transition-all"></div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <input
                                        type="text"
                                        class="flex-1 p-2 text-sm border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent"
                                        placeholder="Añadir nueva subtarea..."
                                    />
                                    <select
                                        class="p-2 text-sm border border-slate-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent">
                                        <option value="" disabled selected>Departamento</option>
                                        <option value="sistemas-ti">Sistemas TI</option>
                                        <option value="mantenimiento">Mantenimiento</option>
                                        <option value="auditoria">Auditoría Interna</option>
                                    </select>
                                    <button
                                        class="flex-shrink-0 p-2 text-sm font-semibold text-white bg-sky-500 rounded-lg hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500"
                                        aria-label="Añadir subtarea"
                                    >
                                        <i class="pi pi-plus"></i>
                                    </button>
                                </div>
                                <div class="space-y-2">
                                    <div class="relative bg-white p-3 rounded-lg border border-slate-200 shadow-sm">
                                        <div
                                            class="absolute top-2 right-2 text-[10px] font-bold px-2 py-0.5 rounded-full text-green-600 bg-green-100">
                                            Completada
                                        </div>
                                        <div class="flex items-start gap-3">
                                            <input type="checkbox" checked class="mt-1 w-4 h-4 accent-sky-500"/>
                                            <div class="flex-1">
                                                <div class="text-sm font-semibold text-gray-400 line-through">Reemplazar
                                                    patch cord y puerto dañado
                                                </div>
                                                <div class="text-[11px] text-gray-500 mt-1">
                                                    <span class="bg-gray-200 px-2 py-0.5 rounded-full text-xs">Mantenimiento</span>
                                                    <span class="ml-2">Vencía: 2025-09-05</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="relative bg-white p-3 rounded-lg border border-slate-200 shadow-sm">
                                        <div
                                            class="absolute top-2 right-2 text-[10px] font-bold px-2 py-0.5 rounded-full text-yellow-600 bg-yellow-100">
                                            Pendiente
                                        </div>
                                        <div class="flex items-start gap-3">
                                            <input type="checkbox" class="mt-1 w-4 h-4 accent-sky-500"/>
                                            <div class="flex-1">
                                                <div class="text-sm font-semibold text-gray-800">Actualizar firmware del
                                                    router
                                                </div>
                                                <div class="text-[11px] text-gray-500 mt-1">
                                                    <span class="bg-gray-200 px-2 py-0.5 rounded-full text-xs">Sistemas TI</span>
                                                    <span class="ml-2 font-bold">Vencía: 2025-09-04</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </p-panel>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Historial -->
<p-dialog
    [(visible)]="mostrarHistorial"
    header="Historial de la Observación"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="w-full max-w-2xl">
    <app-historial [observacionId]="observacionId"></app-historial>
</p-dialog>
