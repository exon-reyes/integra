<app-title
    description="Consulta la información básica de los colaboradores"
    iconClass="isc i-member"
    title="Catálago de Colaboradores"/>

<div *hasPermission="Autoridades.VER_INDICADORES_EMPLEADOS" class="mt-4 mb-2 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div
        class="bg-white shadow rounded-lg p-4 flex items-center gap-4 ">
        <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center shadow-sm">
            <i class="pi pi-users text-blue-600 text-lg"></i>
        </div>
        <div>
            <div class="text-2xl font-bold text-blue-800">{{ numEmpleadosActivos }}</div>
            <div class="text-sm text-blue-600 font-medium">Empleados activos</div>
        </div>
    </div>
    <div
        class="bg-white shadow border-indigo-200 rounded-lg p-4 flex items-center gap-4">
        <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center shadow-sm">
            <i class="pi pi-users text-indigo-600 text-lg"></i>
        </div>
        <div>
            <div class="text-2xl font-bold text-indigo-800">{{ numEmpleadosReingreso }}</div>
            <div class="text-sm text-indigo-600 font-medium">Empleados reingresados</div>
        </div>
    </div>
    <div
        class="bg-white shadow rounded-lg p-4 flex items-center gap-4 ">
        <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center shadow-sm">
            <i class="pi pi-users text-red-600 text-lg"></i>
        </div>
        <div>
            <div class="text-2xl font-bold text-red-800">{{ numEmpleadosInactivos }}</div>
            <div class="text-sm text-red-600 font-medium">Bajas de empleados</div>
        </div>
    </div>
</div>
<p-panel [collapsed]="false" [toggleable]="true" class="my-1" header="Filtros">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Buscar</label>
            <p-iconfield>
                <p-inputicon class="pi pi-search"/>
                <input (input)="dt.filterGlobal($any($event.target).value, 'contains')" [(ngModel)]="searchValue"
                       class="w-full border-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                       pInputText
                       placeholder="Buscar empleados..."/>
            </p-iconfield>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Unidad</label>
            <p-multiSelect (ngModelChange)="onUnidadChange($event)" [(ngModel)]="selectedUnidad"
                           [options]="unidades"
                           [panelStyle]="{ minWidth: '16rem' }" optionLabel="name" optionValue="code"
                           placeholder="Todas las unidades" style="width: 100%">
                <ng-template #item let-option><span>{{ option.name }}</span></ng-template>
            </p-multiSelect>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Puesto</label>
            <p-multiSelect (ngModelChange)="onPuestoChange($event)" [(ngModel)]="selectedPuesto" [options]="puestos"
                           [panelStyle]="{ minWidth: '16rem' }" optionLabel="name" optionValue="code"
                           placeholder="Todos los puestos" style="width: 100%">
                <ng-template #item let-option><span>{{ option.name }}</span></ng-template>
            </p-multiSelect>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
            <p-multiSelect (ngModelChange)="onEstatusChange($event)" [(ngModel)]="selectedEstatus"
                           [options]="estatusOptions"
                           [panelStyle]="{ minWidth: '12rem' }" optionLabel="name" optionValue="code"
                           placeholder="Todos los estados" style="width: 100%">
                <ng-template #item let-option><span>{{ option.name }}</span></ng-template>
            </p-multiSelect>
        </div>
    </div>
</p-panel>

<div class="bg-white shadow-sm rounded-lg border border-gray-100">
    <div class="p-4 border-b border-gray-100">
        <div class="flex gap-2">
            <p-button (onClick)="sincronizar()" icon="pi pi-sync" label="Sincronizar" severity="info" size="small"
                      styleClass="px-3 py-2 rounded-md transition-colors duration-200"></p-button>
            <p-button (onClick)="exportarExcel()" *hasPermission="Autoridades.EXPORTAR_EMPLEADOS"
                      icon="pi pi-file-excel" label="Exportar Excel" severity="success"
                      size="small"
                      styleClass="px-3 py-2 rounded-md transition-colors duration-200"></p-button>
            <p-button (onClick)="imprimir()" *hasPermission="Autoridades.EXPORTAR_EMPLEADOS" icon="pi pi-print"
                      label="Imprimir" severity="secondary"
                      size="small"
                      styleClass="px-3 py-2 rounded-md transition-colors duration-200"></p-button>
            <p-button *ngIf="puedeUsarFiltroAvanzado" (onClick)="mostrarFiltroAvanzado()" [icon]="filtroActivo ? 'pi pi-filter-fill' : 'pi pi-filter'"
                      [label]="filtroActivo ? 'Filtro Activo' : 'Filtro Avanzado'" severity="secondary"
                      size="small"
                      styleClass="px-3 py-2 rounded-md transition-colors duration-200"></p-button>
        </div>
    </div>

    <p-table #dt
             [globalFilterFields]="['codigoEmpleado','puestoNombre','nombreCompleto','unidadNombreCompleto','estatus']"
             [rowsPerPageOptions]="[200,400,500,1000]"
             [rows]="200"
             [showCurrentPageReport]="true"
             [tableStyle]="{ 'min-width': '50rem' }"
             [value]="empleados()"
             class="border-0"
             currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} entradas"
             paginator="true"
             scrollHeight="calc(100vh - 428px)"
             scrollable="true"
             size="small">
        <ng-template #header>
            <tr class="bg-gray-50">
                <th class="font-medium text-gray-700 py-3 px-4">N°</th>
                <th class="font-medium text-gray-700 py-3 px-4" pSortableColumn="codigoEmpleado">
                    <p-sortIcon field="codigoEmpleado"/>
                    Código
                </th>
                <th class="font-medium text-gray-700 py-3 px-4" pSortableColumn="nombreCompleto">
                    <p-sortIcon field="nombreCompleto"/>
                    Nombre Completo
                </th>
                <th class="font-medium text-gray-700 py-3 px-4" pSortableColumn="unidadNombreCompleto">
                    <p-sortIcon field="unidadNombreCompleto"/>
                    Unidad
                </th>
                <th class="font-medium text-gray-700 py-3 px-4" pSortableColumn="puestoNombre">
                    <p-sortIcon field="puestoNombre"/>
                    Puesto
                </th>
                <th class="font-medium text-gray-700 py-3 px-4" pSortableColumn="estatus">
                    <p-sortIcon field="estatus"/>
                    Estado
                </th>
                <th>Fecha alta</th>
                <th>Fecha baja</th>
            </tr>
        </ng-template>
        <ng-template #body let-empleado let-rowIndex="rowIndex">
            <tr class="text-sm">
                <td class="py-3 px-4 font-medium text-gray-800">{{ rowIndex + 1 }}</td>
                <td style="width:8%">{{ empleado.codigoEmpleado }}</td>
                <td>{{ empleado.nombreCompleto }}</td>
                <td>{{ empleado.unidadNombreCompleto }}</td>
                <td>{{ empleado.puestoNombre }}</td>
                <td>
          <span
              class="inline-flex items-center gap-2 px-2 py-1 rounded-full text-xs font-medium {{ empleado.estatus === 'B' ? 'bg-red-100 text-red-800':'bg-green-100 text-green-800'  }}">
            <i class="pi {{ empleado.estatus === 'A' ?'pi-check-circle': 'pi-times-circle'  }}"></i>
              @switch (empleado.estatus) {
                  @case ('A') {
                      Activo
                  }
                  @case ('R') {
                      Reingreso
                  }
                  @default {
                      Baja
                  }
              }
          </span>
                </td>
                <td style="width:6%">{{ empleado.fechaAlta }}</td>
                <td style="width:6%">{{ empleado.fechaBaja }}</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog [(visible)]="mostrarModal" [closable]="true" [draggable]="false" [modal]="true" [resizable]="false"
          header="Filtro Avanzado" styleClass="w-96">
    <div class="space-y-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Supervisor</label>
            <p-select [(ngModel)]="supervisorSeleccionado" [options]="supervisores"
                      appendTo="body" class="w-full"
                      optionLabel="nombreCompleto"
                      optionValue="id"
                      placeholder="Seleccionar supervisor">
            </p-select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Zona</label>
            <p-select [(ngModel)]="zonaSeleccionada" [options]="zonas"
                      appendTo="body" class="w-full"
                      optionLabel="nombre"
                      optionValue="id"
                      placeholder="Seleccionar zona">
            </p-select>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <div class="flex gap-2 justify-end">
            <p-button (onClick)="limpiarFiltros()" label="Limpiar" severity="secondary" size="small"></p-button>
            <p-button (onClick)="aplicarFiltroAvanzado()" label="Aplicar" size="small"></p-button>
        </div>
    </ng-template>
</p-dialog>
